"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_get=function t(e,r,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,r);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,n)}if("value"in o)return o.value;var i=o.get;if(void 0!==i)return i.call(n)},factory=function(t){var e=function(e){function r(t){var e=t.host,n=t.transaction_signer;_classCallCheck(this,r);var o=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return o.transaction_signer=n,o.global_nonces={},o}return _inherits(r,e),_createClass(r,[{key:"send",value:function(t,e){var n=this,o=t;o instanceof Array||(o=[o]);var a=!0,i=!1,s=void 0;try{for(var c,u=o[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value;if("eth_sendTransaction"==l.method)throw new Error("HookedWeb3Provider does not support synchronous transactions. Please provide a callback.")}}catch(t){i=!0,s=t}finally{try{!a&&u.return&&u.return()}finally{if(i)throw s}}var f=function(o){return o?e(o):_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"send",n).call(n,t,e)};return this.rewritePayloads(0,o,{},f)}},{key:"sendAsync",value:function(t,e){var n=this,o=function(o){return o?e(o):void _get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"sendAsync",n).call(n,t,e)},a=t;t instanceof Array||(a=[t]),this.rewritePayloads(0,a,{},o)}},{key:"rewritePayloads",value:function(e,r,n,o){var a=this;if(e>=r.length)return o();var i=r[e],s=function(t){return null!=t?o(t):a.rewritePayloads(e+1,r,n,o)};if("eth_sendTransaction"!=i.method)return s();var c=i.params[0],u=c.from;this.transaction_signer.hasAddress(u,function(e,r){if(null!=e||0==r)return s(e);var l=function(e){var r=n[u];null!=r?e(null,r):a.sendAsync({jsonrpc:"2.0",method:"eth_getTransactionCount",params:[u,"pending"],id:(new Date).getTime()},function(r,n){if(null!=r)e(r);else{var o=n.result;e(null,t.prototype.toDecimal(o))}})};l(function(e,r){if(null!=e)return o(e);var l=Math.max(r,a.global_nonces[u]||0);c.nonce=t.prototype.toHex(l),n[u]=l+1,a.global_nonces[u]=l+1,a.transaction_signer.signTransaction(c,function(t,e){return null!=t?s(t):(i.method="eth_sendRawTransaction",i.params=[e],s())})})})}},{key:"prepareRequest",value:function(t){var e=_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"prepareRequest",this).call(this,t);if(!this.host.match(/^https:/))return e;var n;try{if(!sessionStorage.getItem("INJECT_AUTH"))throw null;var o=sessionStorage.getItem("AUTHBAR.TOKEN");n=JSON.parse(o).blockone}catch(t){}if(!n)try{if(!process.env.INJECT_AUTH)throw null;n=process.env.WALLET_TOKEN}catch(t){}return n&&e.setRequestHeader("Authorization","Bearer "+n),e}}]),r}(t.providers.HttpProvider);return e};"undefined"!=typeof module?module.exports=factory(require("web3")):window.HookedWeb3Provider=factory(Web3);